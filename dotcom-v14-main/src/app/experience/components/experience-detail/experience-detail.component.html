<div class="experience-detail-container" *ngIf="!isLoading && experience">
  <!-- Header -->
  <div class="detail-header">
    <button mat-icon-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>{{ experience.title }}</h1>
    <div class="header-actions">
      <button mat-stroked-button (click)="editExperience()">
        <mat-icon>edit</mat-icon>
        Edit
      </button>
      <button mat-stroked-button color="warn" (click)="deleteExperience()">
        <mat-icon>delete</mat-icon>
        Delete
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="detail-content">
    <!-- Image Gallery -->
    <div class="image-gallery">
      <div class="main-image">
        <img 
          [src]="experience.images[selectedImageIndex] || 'assets/images/placeholder-experience.jpg'" 
          [alt]="experience.title"
          onerror="this.src='assets/images/placeholder-experience.jpg'"
        >
        <div class="image-navigation" *ngIf="experience.images.length > 1">
          <button mat-fab color="primary" (click)="previousImage()" class="nav-button prev">
            <mat-icon>chevron_left</mat-icon>
          </button>
          <button mat-fab color="primary" (click)="nextImage()" class="nav-button next">
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>
      </div>
      
      <div class="image-thumbnails" *ngIf="experience.images.length > 1">
        <img 
          *ngFor="let image of experience.images; let i = index"
          [src]="image"
          [alt]="experience.title + ' - Image ' + (i + 1)"
          [class.active]="i === selectedImageIndex"
          (click)="selectImage(i)"
          onerror="this.src='assets/images/placeholder-experience.jpg'"
        >
      </div>
    </div>

    <!-- Experience Info -->
    <div class="experience-info">
      <!-- Quick Info Card -->
      <mat-card class="quick-info-card">
        <mat-card-content>
          <div class="price-section">
            <div class="price">{{ formatPrice(experience.price, experience.currency) }}</div>
            <div class="price-label">per person</div>
          </div>
          
          <div class="rating-section">
            <div class="rating">
              <mat-icon 
                *ngFor="let star of getStarRating(experience.rating)" 
                [class.filled]="star"
              >
                {{ star ? 'star' : 'star_border' }}
              </mat-icon>
              <span class="rating-text">{{ experience.rating }} ({{ experience.reviewCount }} reviews)</span>
            </div>
          </div>

          <div class="quick-details">
            <div class="detail-item">
              <mat-icon>schedule</mat-icon>
              <span>{{ formatDuration(experience.duration) }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>location_on</mat-icon>
              <span>{{ experience.location }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>group</mat-icon>
              <span>Max {{ experience.maxParticipants }} participants</span>
            </div>
            <div class="detail-item">
              <mat-icon>fitness_center</mat-icon>
              <span>{{ experience.difficulty | titlecase }} difficulty</span>
            </div>
          </div>

          <button mat-raised-button color="primary" class="book-button">
            <mat-icon>event_available</mat-icon>
            Book Now
          </button>
        </mat-card-content>
      </mat-card>

      <!-- Description -->
      <mat-card class="description-card">
        <mat-card-header>
          <mat-card-title>About This Experience</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p class="description">{{ experience.description }}</p>
          
          <div class="category-chip">
            <mat-chip-list>
              <mat-chip [class]="'category-' + experience.category">
                {{ experience.category | titlecase }}
              </mat-chip>
            </mat-chip-list>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Highlights -->
      <mat-card class="highlights-card" *ngIf="experience.highlights.length > 0">
        <mat-card-header>
          <mat-card-title>Highlights</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <ul class="highlights-list">
            <li *ngFor="let highlight of experience.highlights">
              <mat-icon>check_circle</mat-icon>
              <span>{{ highlight }}</span>
            </li>
          </ul>
        </mat-card-content>
      </mat-card>

      <!-- What's Included / Excluded -->
      <div class="included-excluded-section">
        <mat-card class="included-card" *ngIf="experience.included.length > 0">
          <mat-card-header>
            <mat-card-title>What's Included</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <ul class="included-list">
              <li *ngFor="let item of experience.included">
                <mat-icon>add_circle</mat-icon>
                <span>{{ item }}</span>
              </li>
            </ul>
          </mat-card-content>
        </mat-card>

        <mat-card class="excluded-card" *ngIf="experience.excluded.length > 0">
          <mat-card-header>
            <mat-card-title>What's Not Included</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <ul class="excluded-list">
              <li *ngFor="let item of experience.excluded">
                <mat-icon>remove_circle</mat-icon>
                <span>{{ item }}</span>
              </li>
            </ul>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Additional Information -->
      <mat-card class="additional-info-card">
        <mat-card-header>
          <mat-card-title>Additional Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="info-section">
            <h4>Meeting Point</h4>
            <p>{{ experience.meetingPoint }}</p>
          </div>

          <div class="info-section" *ngIf="experience.languages.length > 0">
            <h4>Languages</h4>
            <mat-chip-list>
              <mat-chip *ngFor="let language of experience.languages">
                {{ language }}
              </mat-chip>
            </mat-chip-list>
          </div>

          <div class="info-section">
            <h4>Cancellation Policy</h4>
            <p>{{ experience.cancellationPolicy }}</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="loading-container">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Loading experience details...</p>
</div>

<!-- Error State -->
<div *ngIf="!isLoading && !experience" class="error-container">
  <mat-icon>error_outline</mat-icon>
  <h2>Experience Not Found</h2>
  <p>The experience you're looking for doesn't exist or has been removed.</p>
  <button mat-raised-button color="primary" (click)="goBack()">
    Back to Experiences
  </button>
</div>